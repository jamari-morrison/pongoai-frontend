"use strict";var e="undefined"!=typeof WeakRef,t=function(){function t(t){e?this._weakRef=new WeakRef(t):this._instance=t}return t.prototype.deref=function(){var e,t,i,o;return this._weakRef?(o=null===(e=this._weakRef)||void 0===e?void 0:e.deref())||delete this._weakRef:(null===(i=null===(t=o=this._instance)||void 0===t?void 0:t.isDisposed)||void 0===i?void 0:i.call(t))&&delete this._instance,o},t}(),i=!1,o=0,s=new(function(){function e(){this.__keyborgCoreRefs={},this._isNavigatingWithKeyboard=!1}return e.prototype.add=function(e){var i=e.id;i in this.__keyborgCoreRefs||(this.__keyborgCoreRefs[i]=new t(e))},e.prototype.remove=function(e){delete this.__keyborgCoreRefs[e],0===Object.keys(this.__keyborgCoreRefs).length&&(this._isNavigatingWithKeyboard=!1)},e.prototype.setVal=function(e){if(this._isNavigatingWithKeyboard!==e){this._isNavigatingWithKeyboard=e;for(var t=0,i=Object.keys(this.__keyborgCoreRefs);t<i.length;t++){var o=i[t],s=this.__keyborgCoreRefs[o].deref();s?s.update(e):this.remove(o)}}},e.prototype.getVal=function(){return this._isNavigatingWithKeyboard},e}()),n=function(){function e(e){var n=this;this._isMouseUsed=!1,this._onFocusIn=function(e){if(n._isMouseUsed)n._isMouseUsed=!1;else if(!s.getVal()){var t=e.details;t.relatedTarget&&(t.isFocusedProgrammatically||void 0===t.isFocusedProgrammatically||s.setVal(!0))}},this._onMouseDown=function(e){0===e.buttons||0===e.clientX&&0===e.clientY&&0===e.screenX&&0===e.screenY||(n._isMouseUsed=!0,s.setVal(!1))},this._onKeyDown=function(e){var t=s.getVal();t||9!==e.keyCode?t&&27===e.keyCode&&n._scheduleDismiss():s.setVal(!0)},this.id="c"+ ++o,this._win=e;var r=e.document;r.addEventListener("keyborg:focusin",this._onFocusIn,!0),r.addEventListener("mousedown",this._onMouseDown,!0),e.addEventListener("keydown",this._onKeyDown,!0),function(e){var o=e;i||(i=function(e){var t=e.HTMLElement,i=t.prototype.focus,o=!1;return t.prototype.focus=function(){o=!0},e.document.createElement("button").focus(),t.prototype.focus=i,o}(o));var s=o.HTMLElement.prototype.focus;if(!s.__keyborgNativeFocus){o.HTMLElement.prototype.focus=r;var n=o.__keyborgData={focusInHandler:function(e){var t,o=e.target;if(o){var s=document.createEvent("HTMLEvents");s.initEvent("keyborg:focusin",!0,!0);var r={relatedTarget:e.relatedTarget||void 0};(i||n.lastFocusedProgrammatically)&&(r.isFocusedProgrammatically=o===(null===(t=n.lastFocusedProgrammatically)||void 0===t?void 0:t.deref()),n.lastFocusedProgrammatically=void 0),s.details=r,o.dispatchEvent(s)}}};o.document.addEventListener("focusin",o.__keyborgData.focusInHandler,!0),r.__keyborgNativeFocus=s}function r(){var e=o.__keyborgData;return e&&(e.lastFocusedProgrammatically=new t(this)),s.apply(this,arguments)}}(e),s.add(this)}return e.prototype.dispose=function(){var e=this._win;if(e){this._dismissTimer&&(e.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),function(e){var t=e,i=t.HTMLElement.prototype,o=i.focus.__keyborgNativeFocus,s=t.__keyborgData;s&&(t.document.removeEventListener("focusin",s.focusInHandler,!0),delete t.__keyborgData),o&&(i.focus=o)}(e);var t=e.document;t.removeEventListener("keyborg:focusin",this._onFocusIn,!0),t.removeEventListener("mousedown",this._onMouseDown,!0),e.removeEventListener("keydown",this._onKeyDown,!0),delete this._win,s.remove(this.id)}},e.prototype.isDisposed=function(){return!!this._win},e.prototype.update=function(e){var t,i,o=null===(i=null===(t=this._win)||void 0===t?void 0:t.__keyborg)||void 0===i?void 0:i.refs;if(o)for(var s=0,n=Object.keys(o);s<n.length;s++)r.update(o[n[s]],e)},e.prototype._scheduleDismiss=function(){var e=this,t=this._win;if(t){this._dismissTimer&&(t.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);var i=t.document.activeElement;this._dismissTimer=t.setTimeout((function(){e._dismissTimer=void 0;var o=t.document.activeElement;i&&o&&i===o&&s.setVal(!1)}),500)}},e}(),r=function(){function e(e){var t;this._cb=[],this._id="k"+ ++o,this._win=e;var i=e.__keyborg;i?(this._core=i.core,i.refs[this._id]=this):(this._core=new n(e),e.__keyborg={core:this._core,refs:(t={},t[this._id]=this,t)})}return e.create=function(t){return new e(t)},e.dispose=function(e){e.dispose()},e.update=function(e,t){e._cb.forEach((function(e){return e(t)}))},e.prototype.dispose=function(){var e,t=null===(e=this._win)||void 0===e?void 0:e.__keyborg;(null==t?void 0:t.refs[this._id])&&(delete t.refs[this._id],0===Object.keys(t.refs).length&&(t.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win},e.prototype.isNavigatingWithKeyboard=function(){return s.getVal()},e.prototype.subscribe=function(e){this._cb.push(e)},e.prototype.unsubscribe=function(e){var t=this._cb.indexOf(e);t>=0&&this._cb.splice(t,1)},e.prototype.setVal=function(e){s.setVal(e)},e}();exports.KEYBORG_FOCUSIN="keyborg:focusin",exports.Keyborg=r,exports.createKeyborg=function(e){return r.create(e)},exports.disposeKeyborg=function(e){r.dispose(e)},exports.getLastFocusedProgrammatically=function(e){var t,i=e.__keyborgData;return i?(null===(t=i.lastFocusedProgrammatically)||void 0===t?void 0:t.deref())||null:void 0},exports.nativeFocus=function(e){var t=e.focus;t.__keyborgNativeFocus?t.__keyborgNativeFocus.call(e):e.focus()};
//# sourceMappingURL=keyborg.cjs.production.min.js.map
