import { useId, usePrevious } from '@fluentui/react-utilities';
import { themeToCSSVariables } from '@fluentui/react-theme';
import * as React from 'react';
/**
 * Writes a theme as css variables in a style tag on the provided targetDocument as a rule applied to a CSS class
 *
 * @returns CSS class to apply the rule
 */

export var useThemeStyleTag = function (options) {
  var targetDocument = options.targetDocument,
      theme = options.theme;
  var styleTagId = useId('fluent-provider');
  var styleTag = React.useMemo(function () {
    if (!targetDocument) {
      return null;
    }

    var tag = targetDocument.createElement('style');
    tag.setAttribute('id', styleTagId);
    targetDocument.head.appendChild(tag);
    return tag;
  }, [styleTagId, targetDocument]);
  var cssRule = React.useMemo(function () {
    var cssVars = themeToCSSVariables(theme);
    var cssVarsAsString = Object.keys(cssVars).reduce(function (cssVarRule, cssVar) {
      cssVarRule += cssVar + ": " + cssVars[cssVar] + "; ";
      return cssVarRule;
    }, ''); // result: .fluent-provider1 { --css-var: '#fff' }

    return "." + styleTagId + " { " + cssVarsAsString + " }";
  }, [theme, styleTagId]);
  var previousCssRule = usePrevious(cssRule);

  if (styleTag && previousCssRule !== cssRule) {
    var sheet = styleTag.sheet;

    if (sheet.cssRules.length > 0) {
      sheet.deleteRule(0);
    }

    sheet.insertRule(cssRule, 0);
  } // Removes the style tag from the targetDocument on unmount or change


  React.useEffect(function () {
    return function () {
      var _a;

      if (styleTag) {
        // IE11 safe node removal, otherwise use node.remove()
        (_a = styleTag.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(styleTag);
      }
    };
  }, [styleTag]);
  return styleTagId;
};
//# sourceMappingURL=useThemeStyleTag.js.map